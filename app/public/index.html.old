<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –®–∫–æ–ª–∞ –†–µ–º–æ–Ω—Ç–∞</title>
  <style>
    :root {
      --bg: #0d1117;
      --bg-card: #161b22;
      --bg-hover: #21262d;
      --border: #30363d;
      --text: #c9d1d9;
      --text-muted: #8b949e;
      --accent: #58a6ff;
      --green: #3fb950;
      --yellow: #d29922;
      --red: #f85149;
      --purple: #a371f7;
      --orange: #f0883e;
      --pink: #db61a2;
      --cyan: #39c5cf;

      /* Block colors */
      --block-system: #8b949e;
      --block-prep: #f85149;
      --block-comm: #58a6ff;
      --block-construct: #a371f7;
      --block-floors: #f0883e;
      --block-finish: #3fb950;
      --block-doors: #db61a2;
      --block-facade: #39c5cf;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header - hidden, merged into nav */
    header { display: none; }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      font-size: 32px;
    }

    h1 {
      font-size: 24px;
      font-weight: 600;
    }

    h1 span {
      color: var(--text-muted);
      font-weight: 400;
    }

    .search-box {
      display: flex;
      align-items: center;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      width: 300px;
    }

    .search-box input {
      background: none;
      border: none;
      color: var(--text);
      font-size: 14px;
      width: 100%;
      outline: none;
    }

    .search-box input::placeholder { color: var(--text-muted); }

    /* Stats */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
    }

    .stat-card.directions::before { background: var(--accent); }
    .stat-card.technologies::before { background: var(--green); }
    .stat-card.draft::before { background: var(--text-muted); }
    .stat-card.approved::before { background: var(--green); }

    .stat-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
    }

    .stat-card.directions .stat-value { color: var(--accent); }
    .stat-card.technologies .stat-value { color: var(--green); }
    .stat-card.draft .stat-value { color: var(--text-muted); }
    .stat-card.approved .stat-value { color: var(--green); }

    .stat-label {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Timeline Vertical */
    .timeline-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 30px;
    }

    .timeline-section h2 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    .timeline-vertical {
      display: flex;
      flex-direction: column;
      gap: 0;
      position: relative;
    }

    .timeline-step {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      position: relative;
      padding-bottom: 24px;
    }

    .timeline-step:last-child {
      padding-bottom: 0;
    }

    .timeline-step::before {
      content: '';
      position: absolute;
      left: 19px;
      top: 40px;
      bottom: 0;
      width: 2px;
      background: var(--border);
    }

    .timeline-step:last-child::before {
      display: none;
    }

    .timeline-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      flex-shrink: 0;
      position: relative;
      z-index: 1;
    }

    .timeline-content {
      flex: 1;
      padding-top: 8px;
    }

    .timeline-title {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 4px;
    }

    .timeline-desc {
      font-size: 13px;
      color: var(--text-muted);
    }

    .timeline-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .timeline-tag {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 12px;
      background: var(--bg-hover);
      cursor: pointer;
      transition: all 0.2s;
    }

    .timeline-tag:hover {
      transform: scale(1.05);
    }

    /* Block colors for timeline */
    .block-system .timeline-number { background: var(--block-system); color: #000; }
    .block-prep .timeline-number { background: var(--block-prep); color: #fff; }
    .block-comm .timeline-number { background: var(--block-comm); color: #000; }
    .block-construct .timeline-number { background: var(--block-construct); color: #fff; }
    .block-floors .timeline-number { background: var(--block-floors); color: #000; }
    .block-finish .timeline-number { background: var(--block-finish); color: #000; }
    .block-doors .timeline-number { background: var(--block-doors); color: #fff; }
    .block-facade .timeline-number { background: var(--block-facade); color: #000; }

    .block-system .timeline-tag { background: rgba(139, 148, 158, 0.2); color: var(--block-system); }
    .block-prep .timeline-tag { background: rgba(248, 81, 73, 0.2); color: var(--block-prep); }
    .block-comm .timeline-tag { background: rgba(88, 166, 255, 0.2); color: var(--block-comm); }
    .block-construct .timeline-tag { background: rgba(163, 113, 247, 0.2); color: var(--block-construct); }
    .block-floors .timeline-tag { background: rgba(240, 136, 62, 0.2); color: var(--block-floors); }
    .block-finish .timeline-tag { background: rgba(63, 185, 80, 0.2); color: var(--block-finish); }
    .block-doors .timeline-tag { background: rgba(219, 97, 162, 0.2); color: var(--block-doors); }
    .block-facade .timeline-tag { background: rgba(57, 197, 207, 0.2); color: var(--block-facade); }

    /* Filters */
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .filter-btn {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 8px 18px;
      font-size: 13px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filter-btn:hover { border-color: var(--accent); }
    .filter-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #000;
    }

    /* Section Groups */
    .section-group {
      margin-bottom: 40px;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--border);
    }

    .section-icon {
      font-size: 24px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
    }

    .section-count {
      font-size: 13px;
      color: var(--text-muted);
      margin-left: auto;
    }

    .section-header.block-system { border-color: var(--block-system); }
    .section-header.block-prep { border-color: var(--block-prep); }
    .section-header.block-comm { border-color: var(--block-comm); }
    .section-header.block-construct { border-color: var(--block-construct); }
    .section-header.block-floors { border-color: var(--block-floors); }
    .section-header.block-finish { border-color: var(--block-finish); }
    .section-header.block-doors { border-color: var(--block-doors); }
    .section-header.block-facade { border-color: var(--block-facade); }

    /* Grid */
    .directions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .direction-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }

    .direction-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 4px;
    }

    .direction-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }

    .direction-card.hidden { display: none; }

    /* Card sizes based on tech count */
    .direction-card.size-large {
      grid-column: span 1;
    }

    @media (min-width: 900px) {
      .direction-card.size-large {
        grid-column: span 2;
      }
    }

    /* Block colors for cards */
    .direction-card.block-system::before { background: var(--block-system); }
    .direction-card.block-prep::before { background: var(--block-prep); }
    .direction-card.block-comm::before { background: var(--block-comm); }
    .direction-card.block-construct::before { background: var(--block-construct); }
    .direction-card.block-floors::before { background: var(--block-floors); }
    .direction-card.block-finish::before { background: var(--block-finish); }
    .direction-card.block-doors::before { background: var(--block-doors); }
    .direction-card.block-facade::before { background: var(--block-facade); }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .card-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .card-id {
      font-size: 11px;
      color: var(--text-muted);
      background: var(--bg-hover);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: monospace;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .card-stages {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .stage-badge {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 12px;
    }

    .stage-badge.—á–µ—Ä–Ω–æ–≤–∞—è {
      background: rgba(210, 153, 34, 0.2);
      color: var(--yellow);
    }

    .stage-badge.—á–∏—Å—Ç–æ–≤–∞—è {
      background: rgba(63, 185, 80, 0.2);
      color: var(--green);
    }

    /* Multi-color progress bar */
    .card-progress {
      margin-bottom: 12px;
    }

    .progress-bar-multi {
      height: 8px;
      background: var(--bg-hover);
      border-radius: 4px;
      overflow: hidden;
      display: flex;
    }

    .progress-segment {
      height: 100%;
      transition: width 0.3s;
    }

    .progress-segment.approved { background: var(--green); }
    .progress-segment.review { background: var(--yellow); }
    .progress-segment.draft { background: var(--text-muted); opacity: 0.3; }

    .progress-legend {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .progress-legend span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .legend-dot.approved { background: var(--green); }
    .legend-dot.review { background: var(--yellow); }
    .legend-dot.draft { background: var(--text-muted); }

    .card-tech-count {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .card-tech-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Direction View */
    .direction-view {
      display: none;
    }

    .direction-view.active {
      display: block;
    }

    .back-btn { display: none; }

    .back-btn:hover { text-decoration: underline; }

    .direction-header {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 28px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }

    .direction-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }

    .direction-header.block-system::before { background: var(--block-system); }
    .direction-header.block-prep::before { background: var(--block-prep); }
    .direction-header.block-comm::before { background: var(--block-comm); }
    .direction-header.block-construct::before { background: var(--block-construct); }
    .direction-header.block-floors::before { background: var(--block-floors); }
    .direction-header.block-finish::before { background: var(--block-finish); }
    .direction-header.block-doors::before { background: var(--block-doors); }
    .direction-header.block-facade::before { background: var(--block-facade); }

    .direction-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .direction-title {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .direction-meta {
      display: flex;
      gap: 16px;
      color: var(--text-muted);
      font-size: 14px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .direction-deps {
      display: flex;
      gap: 32px;
      flex-wrap: wrap;
    }

    .dep-group h4 {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .dep-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .dep-tag {
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .dep-tag:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .dep-tag.requires { border-left: 3px solid var(--yellow); }
    .dep-tag.opens { border-left: 3px solid var(--green); }

    .dep-tag-icon {
      font-size: 16px;
    }

    /* Technologies */
    .stage-section {
      margin-bottom: 28px;
    }

    .stage-title {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stage-title.—á–µ—Ä–Ω–æ–≤–∞—è { border-color: var(--yellow); }
    .stage-title.—á–∏—Å—Ç–æ–≤–∞—è { border-color: var(--green); }

    .stage-title span {
      color: var(--text);
      font-weight: 600;
    }

    .stage-title .count {
      margin-left: auto;
      background: var(--bg-hover);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
    }

    .tech-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .tech-item {
      display: flex;
      align-items: center;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px 18px;
      transition: all 0.2s;
    }

    .tech-item:hover {
      border-color: var(--accent);
      background: var(--bg-hover);
    }

    .tech-id {
      font-family: monospace;
      font-size: 11px;
      color: var(--text-muted);
      background: var(--bg-hover);
      padding: 4px 10px;
      border-radius: 4px;
      margin-right: 14px;
      min-width: 85px;
      text-align: center;
    }

    .tech-name {
      flex: 1;
      font-size: 14px;
    }

    .tech-meta {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    .tech-difficulty {
      display: flex;
      gap: 3px;
    }

    .tech-difficulty span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border);
    }

    .tech-difficulty span.filled { background: var(--accent); }

    .tech-status {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 500;
    }

    .tech-status.draft {
      background: rgba(139, 148, 158, 0.2);
      color: var(--text-muted);
    }

    .tech-status.review {
      background: rgba(210, 153, 34, 0.2);
      color: var(--yellow);
    }

    .tech-status.approved {
      background: rgba(63, 185, 80, 0.2);
      color: var(--green);
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
      font-size: 13px;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    /* No results */
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .no-results h3 { margin-bottom: 8px; }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
      justify-content: center;
    }

    .modal {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      max-width: 900px;
      width: 100%;
      margin: 20px auto;
      position: relative;
      max-height: none;
    }

    .modal-header {
      position: sticky;
      top: 0;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 20px 24px;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      z-index: 10;
    }

    .modal-header-content {
      flex: 1;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .modal-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 13px;
      color: var(--text-muted);
    }

    .modal-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .modal-close {
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 8px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      color: var(--text);
      transition: all 0.2s;
      flex-shrink: 0;
      margin-left: 16px;
    }

    .modal-close:hover {
      background: var(--bg-card);
      border-color: var(--accent);
    }

    .modal-body {
      padding: 24px;
    }

    /* Markdown styles */
    .markdown-content h1 {
      font-size: 28px;
      margin: 0 0 16px 0;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--border);
    }

    .markdown-content h2 {
      font-size: 20px;
      margin: 32px 0 16px 0;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
      color: var(--accent);
    }

    .markdown-content h3 {
      font-size: 16px;
      margin: 24px 0 12px 0;
      color: var(--text);
    }

    .markdown-content p {
      margin: 12px 0;
      line-height: 1.7;
    }

    .markdown-content blockquote {
      border-left: 4px solid var(--accent);
      padding-left: 16px;
      margin: 16px 0;
      color: var(--text-muted);
      font-style: italic;
      background: var(--bg-card);
      padding: 12px 16px;
      border-radius: 0 8px 8px 0;
    }

    .markdown-content ul, .markdown-content ol {
      margin: 12px 0;
      padding-left: 24px;
    }

    .markdown-content li {
      margin: 8px 0;
      line-height: 1.6;
    }

    .markdown-content code {
      background: var(--bg-hover);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
    }

    .markdown-content pre {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
      margin: 16px 0;
    }

    .markdown-content pre code {
      background: none;
      padding: 0;
    }

    .markdown-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 14px;
    }

    .markdown-content th {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }

    .markdown-content td {
      border: 1px solid var(--border);
      padding: 10px 12px;
    }

    .markdown-content tr:hover td {
      background: var(--bg-hover);
    }

    .markdown-content hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 24px 0;
    }

    .markdown-content strong {
      color: var(--text);
      font-weight: 600;
    }

    .markdown-content input[type="checkbox"] {
      margin-right: 8px;
    }

    /* Technology Page */
    .tech-view {
      display: none;
    }

    .tech-view.active {
      display: block;
    }

    .tech-page {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      align-items: start;
    }

    @media (max-width: 1000px) {
      .tech-page {
        grid-template-columns: 1fr;
      }
      .tech-sidebar {
        position: static !important;
      }
    }

    /* Sidebar */
    .tech-sidebar {
      position: sticky;
      top: 20px;
    }

    .tech-sidebar-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .tech-sidebar-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    /* Stats grid */
    .tech-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .tech-stat {
      text-align: center;
      padding: 12px 8px;
      background: var(--bg-hover);
      border-radius: 8px;
    }

    .tech-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }

    .tech-stat-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* TOC */
    .tech-toc {
      list-style: none;
    }

    .tech-toc li {
      margin-bottom: 8px;
    }

    .tech-toc a {
      display: block;
      padding: 8px 12px;
      color: var(--text-muted);
      text-decoration: none;
      border-radius: 6px;
      font-size: 13px;
      transition: all 0.2s;
      border-left: 2px solid transparent;
    }

    .tech-toc a:hover {
      background: var(--bg-hover);
      color: var(--text);
      border-left-color: var(--accent);
    }

    .tech-toc a.active {
      background: rgba(88, 166, 255, 0.1);
      color: var(--accent);
      border-left-color: var(--accent);
    }

    /* Related technologies */
    .tech-related-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .tech-related-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: var(--bg-hover);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tech-related-item:hover {
      background: var(--bg-card);
      border-color: var(--accent);
    }

    .tech-related-id {
      font-family: monospace;
      font-size: 10px;
      color: var(--text-muted);
      background: var(--bg);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .tech-related-name {
      flex: 1;
      font-size: 13px;
    }

    .tech-related-reason {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Inline related technologies */
    .tech-related-inline {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin: 24px 0;
    }

    .tech-related-inline-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tech-related-inline-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 12px;
    }

    /* Main content area */
    .tech-main {
      min-width: 0;
    }

    .tech-header {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 28px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }

    .tech-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }

    .tech-header.block-system::before { background: var(--block-system); }
    .tech-header.block-prep::before { background: var(--block-prep); }
    .tech-header.block-comm::before { background: var(--block-comm); }
    .tech-header.block-construct::before { background: var(--block-construct); }
    .tech-header.block-floors::before { background: var(--block-floors); }
    .tech-header.block-finish::before { background: var(--block-finish); }
    .tech-header.block-doors::before { background: var(--block-doors); }
    .tech-header.block-facade::before { background: var(--block-facade); }

    .tech-breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .tech-breadcrumb a {
      color: var(--accent);
      text-decoration: none;
    }

    .tech-breadcrumb a:hover {
      text-decoration: underline;
    }

    .tech-title-row {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }

    .tech-icon {
      font-size: 48px;
      flex-shrink: 0;
    }

    .tech-title-content {
      flex: 1;
    }

    .tech-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .tech-description {
      color: var(--text-muted);
      font-size: 15px;
      line-height: 1.6;
    }

    .tech-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .tech-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 16px;
    }

    .tech-meta-stats {
      display: flex;
      gap: 16px;
      align-items: center;
      font-size: 14px;
      color: var(--text-muted);
    }

    .tech-meta-stat {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tech-meta-stat-value {
      font-weight: 600;
      color: var(--text);
    }

    .tech-badge {
      font-size: 12px;
      padding: 4px 12px;
      border-radius: 16px;
      background: var(--bg-hover);
      color: var(--text-muted);
    }

    .tech-badge.stage {
      border: 1px solid;
    }

    .tech-badge.—á–µ—Ä–Ω–æ–≤–∞—è {
      background: rgba(210, 153, 34, 0.2);
      color: var(--yellow);
      border-color: var(--yellow);
    }

    .tech-badge.—á–∏—Å—Ç–æ–≤–∞—è {
      background: rgba(63, 185, 80, 0.2);
      color: var(--green);
      border-color: var(--green);
    }

    /* Flow visualization */
    .tech-flow {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .tech-flow-title {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 20px;
      text-align: center;
    }

    .tech-flow-diagram {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .tech-flow-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }

    .tech-flow-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .tech-flow-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .tech-flow-card {
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 14px;
      text-align: center;
      min-width: 100px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tech-flow-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .tech-flow-card.current {
      background: rgba(88, 166, 255, 0.15);
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
    }

    .tech-flow-card-id {
      font-family: monospace;
      font-size: 10px;
      color: var(--text-muted);
    }

    .tech-flow-card-name {
      font-size: 12px;
      margin-top: 4px;
      color: var(--text);
    }

    .tech-flow-arrow {
      font-size: 24px;
      color: var(--text-muted);
    }

    /* Content sections */
    .tech-content {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 28px;
    }

    .tech-content section {
      scroll-margin-top: 20px;
    }

    /* Sticky Navigation - Enhanced */
    .top-nav {
      position: sticky;
      top: 0;
      background: rgba(13, 17, 23, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      z-index: 100;
      padding: 16px 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .nav-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 10px 14px;
      border-radius: 8px;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .nav-logo:hover {
      background: var(--bg-hover);
    }

    .nav-logo-icon { font-size: 28px; }

    .nav-logo-text {
      font-weight: 700;
      font-size: 18px;
      color: var(--accent);
    }

    .nav-logo-subtitle {
      font-size: 11px;
      color: var(--text-muted);
      font-weight: 400;
      display: block;
      margin-top: -2px;
    }

    .nav-breadcrumb {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      overflow: hidden;
    }

    .nav-crumb {
      color: var(--text-muted);
      font-size: 16px;
      white-space: nowrap;
      cursor: pointer;
      padding: 8px 14px;
      border-radius: 6px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .nav-crumb:hover {
      color: var(--text);
      background: var(--bg-hover);
    }

    .nav-crumb.active {
      color: var(--text);
      font-weight: 600;
      background: var(--bg-hover);
    }

    .nav-crumb-sep {
      color: var(--text-muted);
      font-size: 16px;
      opacity: 0.5;
    }

    .nav-scroll-indicator {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent) 0%, var(--green) 100%);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
      opacity: 0;
    }

    .top-nav.scrolled .nav-scroll-indicator {
      opacity: 1;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .search-box-nav {
      display: flex;
      align-items: center;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      width: 200px;
    }

    .search-box-nav input {
      background: none;
      border: none;
      color: var(--text);
      font-size: 13px;
      width: 100%;
      outline: none;
    }

    .nav-btn {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-btn:hover {
      border-color: var(--accent);
      background: var(--bg-hover);
    }

    .nav-btn.active {
      background: var(--accent);
      border-color: var(--accent);
    }

    /* Subtitle */
    .subtitle {
      color: var(--text-muted);
      font-size: 14px;
      margin-top: 8px;
    }

    /* Quick Actions Dashboard */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .quick-action {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .quick-action:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .quick-action-icon {
      font-size: 28px;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-hover);
      border-radius: 10px;
    }

    .quick-action-content {
      flex: 1;
    }

    .quick-action-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .quick-action-desc {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Dependency Map */
    .dependency-map {
      display: none;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      overflow: hidden;
    }

    .dependency-map.active {
      display: block;
    }

    .dependency-map-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .dependency-map-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dependency-map-close {
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-muted);
      transition: all 0.2s;
    }

    .dependency-map-close:hover {
      color: var(--text);
      border-color: var(--accent);
    }

    .dependency-svg {
      width: 100%;
      height: 400px;
      background: var(--bg);
      border-radius: 8px;
    }

    .dep-node {
      cursor: pointer;
      transition: all 0.2s;
    }

    .dep-node:hover {
      filter: brightness(1.2);
    }

    .dep-node-circle {
      stroke: var(--border);
      stroke-width: 2;
    }

    .dep-node-text {
      fill: var(--text);
      font-size: 11px;
      text-anchor: middle;
      dominant-baseline: middle;
      pointer-events: none;
    }

    .dep-node-label {
      fill: var(--text-muted);
      font-size: 9px;
      text-anchor: middle;
      pointer-events: none;
    }

    .dep-edge {
      stroke: var(--border);
      stroke-width: 1.5;
      fill: none;
      marker-end: url(#arrowhead);
    }

    .dep-edge.highlight {
      stroke: var(--accent);
      stroke-width: 2;
    }

    /* Process Flow in Direction */
    .process-flow {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .process-flow-title {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .process-steps {
      display: flex;
      align-items: stretch;
      gap: 0;
      overflow-x: auto;
      padding: 10px 0;
    }

    .process-step {
      flex: 0 0 auto;
      min-width: 180px;
      padding: 16px;
      background: var(--bg-hover);
      border-radius: 10px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
    }

    .process-step:hover {
      background: var(--bg-card);
      border-color: var(--accent);
    }

    .process-step.active {
      background: rgba(88, 166, 255, 0.15);
      box-shadow: 0 0 0 2px var(--accent);
    }

    .process-step-num {
      position: absolute;
      top: -10px;
      left: 16px;
      background: var(--accent);
      color: #000;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
    }

    .process-step-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 8px;
      margin-top: 8px;
    }

    .process-step-desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .process-step-count {
      font-size: 11px;
      color: var(--accent);
    }

    .process-arrow {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      color: var(--text-muted);
      font-size: 20px;
    }

    /* Overall Progress Bar */
    .overall-progress {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .overall-progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .overall-progress-title {
      font-weight: 600;
      font-size: 14px;
    }

    .overall-progress-pct {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }

    .overall-progress-bar {
      height: 12px;
      background: var(--bg-hover);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .overall-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--green), var(--accent));
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    .overall-progress-stats {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .timeline-section {
        padding: 16px;
      }

      .stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .direction-header {
        padding: 20px;
      }

      .direction-title {
        font-size: 24px;
      }

      .nav-logo-text {
        display: none;
      }

      .search-box-nav {
        width: 120px;
      }

      .nav-breadcrumb {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Sticky Navigation Bar -->
  <nav class="top-nav" id="top-nav">
    <div class="nav-container">
      <div class="nav-logo" onclick="showMainView()">
        <span class="nav-logo-icon">üèóÔ∏è</span>
        <div>
          <span class="nav-logo-text">–í–®–†</span>
          <span class="nav-logo-subtitle">–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –®–∫–æ–ª–∞ –†–µ–º–æ–Ω—Ç–∞</span>
        </div>
      </div>
      <div class="nav-breadcrumb" id="nav-breadcrumb">
        <span class="nav-crumb active">–ì–ª–∞–≤–Ω–∞—è</span>
      </div>
      <div class="nav-actions">
        <div class="search-box-nav">
          <input type="text" id="search" placeholder="üîç –ü–æ–∏—Å–∫...">
        </div>
        <button class="nav-btn" onclick="toggleDependencyMap()" title="–ö–∞—Ä—Ç–∞ —Å–≤—è–∑–µ–π">
          üó∫Ô∏è
        </button>
      </div>
      <div class="nav-scroll-indicator"></div>
    </div>
  </nav>

  <div class="container">
    <header>
      <div class="logo">
        <span class="logo-icon">üèóÔ∏è</span>
        <h1>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –®–∫–æ–ª–∞ –†–µ–º–æ–Ω—Ç–∞</h1>
      </div>
      <p class="subtitle">–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç</p>
    </header>

    <!-- Main View -->
    <div id="main-view">
      <!-- Quick Actions -->
      <div class="quick-actions" id="quick-actions"></div>

      <!-- Overall Progress -->
      <div class="overall-progress" id="overall-progress"></div>

      <!-- Dependency Map (hidden by default) -->
      <div class="dependency-map" id="dependency-map">
        <div class="dependency-map-header">
          <div class="dependency-map-title">üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å–≤—è–∑–µ–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</div>
          <button class="dependency-map-close" onclick="toggleDependencyMap()">–°–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</button>
        </div>
        <svg class="dependency-svg" id="dependency-svg">
          <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#8b949e"/>
            </marker>
          </defs>
        </svg>
        <div style="text-align: center; margin-top: 12px; font-size: 12px; color: var(--text-muted);">
          –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞. –°—Ç—Ä–µ–ª–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (A ‚Üí B –æ–∑–Ω–∞—á–∞–µ—Ç "B —Ç—Ä–µ–±—É–µ—Ç A").
        </div>
      </div>

      <div class="stats" id="stats"></div>

      <div class="timeline-section">
        <h2>üìã –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —ç—Ç–∞–ø–æ–≤ —Ä–µ–º–æ–Ω—Ç–∞</h2>
        <div class="timeline-vertical" id="timeline"></div>
      </div>

      <div class="filters" id="filters"></div>

      <div id="sections-container"></div>

      <div class="no-results" id="no-results" style="display: none;">
        <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã</p>
      </div>
    </div>

    <!-- Direction View -->
    <div id="direction-view" class="direction-view">
      <div class="back-btn" onclick="showMainView()">‚Üê –í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
      <div id="direction-content"></div>
    </div>

    <!-- Technology View -->
    <div id="tech-view" class="tech-view">
      <div class="back-btn" id="tech-back-btn">‚Üê –ù–∞–∑–∞–¥</div>
      <div class="tech-page">
        <div class="tech-sidebar">
          <!-- TOC -->
          <div class="tech-sidebar-card">
            <div class="tech-sidebar-title">üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</div>
            <ul class="tech-toc" id="tech-toc"></ul>
          </div>

          <!-- Related (hidden - now shown inline in content) -->
          <div class="tech-sidebar-card" id="tech-related-card" style="display: none;">
            <div class="tech-sidebar-title">üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
            <div class="tech-related-list" id="tech-related"></div>
          </div>
        </div>

        <div class="tech-main">
          <div id="tech-header-container"></div>
          <div id="tech-flow-container"></div>
          <div class="tech-content">
            <div class="markdown-content" id="tech-content"></div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –®–∫–æ–ª–∞ –†–µ–º–æ–Ω—Ç–∞ ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç</p>
      <p>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: <span id="generated-date"></span></p>
    </footer>
  </div>

  <!-- Technology Modal -->
  <div class="modal-overlay" id="tech-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-title" id="modal-title"></div>
          <div class="modal-meta" id="modal-meta"></div>
        </div>
        <button class="modal-close" onclick="closeModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="markdown-content" id="modal-content"></div>
      </div>
    </div>
  </div>

  <!-- Markdown parser (simple) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
    let DATA = null;
    let currentFilter = 'all';
    let searchQuery = '';

    // Icons for directions
    const DIRECTION_ICONS = {
      'D00': 'üìã', // –ö—É–ª—å—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
      'D01': 'üî®', // –î–µ–º–æ–Ω—Ç–∞–∂
      'D02': '‚ö°', // –≠–ª–µ–∫—Ç—Ä–∏–∫–∞
      'D03': 'üì°', // –°–ª–∞–±–æ—Ç–æ—á–∫–∞
      'D04': 'üîß', // –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞
      'D05': '‚ùÑÔ∏è', // –ö–ª–∏–º–∞—Ç
      'D06': 'üß±', // –ú–æ–Ω—Ç–∞–∂
      'D07': 'üõ°Ô∏è', // –ò–∑–æ–ª—è—Ü–∏—è
      'D08': 'üéØ', // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç–µ–Ω
      'D09': 'ü™£', // –®—Ç—É–∫–∞—Ç—É—Ä–∫–∞
      'D10': 'üé®', // –ü–æ–∫—Ä–∞—Å–∫–∞
      'D11': 'üìú', // –û–±–æ–∏
      'D12': 'üî≤', // –ü–ª–∏—Ç–∫–∞
      'D13': 'üìê', // –ü–æ–ª—ã —á–µ—Ä–Ω–æ–≤—ã–µ
      'D14': 'ü™µ', // –ü–æ–ª—ã —á–∏—Å—Ç–æ–≤—ã–µ
      'D15': 'ü™ü', // –û–∫–Ω–∞
      'D16': 'üö™', // –î–≤–µ—Ä–∏ –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω—ã–µ
      'D17': 'üö™', // –î–≤–µ—Ä–∏ –≤—Ö–æ–¥–Ω—ã–µ
      'D18': 'üè†'  // –§–∞—Å–∞–¥
    };

    // Block class mapping
    const BLOCK_CLASSES = {
      '–°–∏—Å—Ç–µ–º–Ω–æ–µ': 'block-system',
      '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞': 'block-prep',
      '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏': 'block-comm',
      '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤': 'block-construct',
      '–ü–æ–ª—ã': 'block-floors',
      '–û—Ç–¥–µ–ª–∫–∞': 'block-finish',
      '–î–≤–µ—Ä–∏/–û–∫–Ω–∞': 'block-doors',
      '–§–∞—Å–∞–¥': 'block-facade'
    };

    // Block info for sections
    const BLOCK_INFO = {
      '–°–∏—Å—Ç–µ–º–Ω–æ–µ': { icon: 'üìã', title: '–°–∏—Å—Ç–µ–º–Ω–æ–µ', order: 0 },
      '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞': { icon: 'üî®', title: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞', order: 1 },
      '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏': { icon: '‚ö°', title: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏', order: 2 },
      '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤': { icon: 'üß±', title: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤', order: 3 },
      '–ü–æ–ª—ã': { icon: 'üìê', title: '–ü–æ–ª—ã', order: 4 },
      '–û—Ç–¥–µ–ª–∫–∞': { icon: 'üé®', title: '–û—Ç–¥–µ–ª–∫–∞', order: 5 },
      '–î–≤–µ—Ä–∏/–û–∫–Ω–∞': { icon: 'üö™', title: '–î–≤–µ—Ä–∏ –∏ –æ–∫–Ω–∞', order: 6 },
      '–§–∞—Å–∞–¥': { icon: 'üè†', title: '–§–∞—Å–∞–¥', order: 7 }
    };

    // Timeline steps
    const TIMELINE_STEPS = [
      { num: 1, class: 'block-system', title: '–ö—É–ª—å—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', desc: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –Ω–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥ —Ä–∞–±–æ—Ç', directions: ['D00'] },
      { num: 2, class: 'block-prep', title: '–î–µ–º–æ–Ω—Ç–∞–∂', desc: '–°–Ω–æ—Å –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫, —Å–Ω—è—Ç–∏–µ –ø–æ–∫—Ä—ã—Ç–∏–π', directions: ['D01'] },
      { num: 3, class: 'block-comm', title: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ (—á–µ—Ä–Ω–æ–≤—ã–µ)', desc: '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞, —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞, —Å–ª–∞–±–æ—Ç–æ—á–∫–∞, –∫–ª–∏–º–∞—Ç', directions: ['D02', 'D03', 'D04', 'D05'] },
      { num: 4, class: 'block-construct', title: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤', desc: '–ú–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫, –∏–∑–æ–ª—è—Ü–∏—è', directions: ['D06', 'D07'] },
      { num: 5, class: 'block-floors', title: '–ß–µ—Ä–Ω–æ–≤—ã–µ –ø–æ–ª—ã', desc: '–°—Ç—è–∂–∫–∞, —Ç—ë–ø–ª—ã–µ –ø–æ–ª—ã', directions: ['D13'] },
      { num: 6, class: 'block-finish', title: '–ß–µ—Ä–Ω–æ–≤–∞—è –æ—Ç–¥–µ–ª–∫–∞', desc: '–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç–µ–Ω', directions: ['D08', 'D09'] },
      { num: 7, class: 'block-finish', title: '–ß–∏—Å—Ç–æ–≤–∞—è –æ—Ç–¥–µ–ª–∫–∞', desc: '–ü–æ–∫—Ä–∞—Å–∫–∞, –æ–±–æ–∏, –ø–ª–∏—Ç–∫–∞', directions: ['D10', 'D11', 'D12'] },
      { num: 8, class: 'block-floors', title: '–ß–∏—Å—Ç–æ–≤—ã–µ –ø–æ–ª—ã', desc: '–õ–∞–º–∏–Ω–∞—Ç, –ø–∞—Ä–∫–µ—Ç', directions: ['D14'] },
      { num: 9, class: 'block-doors', title: '–î–≤–µ—Ä–∏ –∏ –æ–∫–Ω–∞', desc: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–≤–µ—Ä–µ–π –∏ –æ–∫–æ–Ω', directions: ['D15', 'D16', 'D17'] },
      { num: 10, class: 'block-facade', title: '–§–∞—Å–∞–¥', desc: '–£—Ç–µ–ø–ª–µ–Ω–∏–µ, –æ—Ç–¥–µ–ª–∫–∞ —Ñ–∞—Å–∞–¥–∞', directions: ['D18'] }
    ];

    async function loadData() {
      const response = await fetch('data.json');
      DATA = await response.json();
      render();
    }

    function render() {
      renderQuickActions();
      renderOverallProgress();
      renderStats();
      renderTimeline();
      renderFilters();
      renderSections();
      renderDependencyMap();
      updateBreadcrumb('main');
      document.getElementById('generated-date').textContent =
        new Date(DATA.meta.generated).toLocaleDateString('ru-RU');
    }

    // Quick Actions
    function renderQuickActions() {
      const container = document.getElementById('quick-actions');

      // Find random direction and tech for "continue learning"
      const randomDir = DATA.directions[Math.floor(Math.random() * DATA.directions.length)];
      const randomTech = randomDir.technologies[Math.floor(Math.random() * randomDir.technologies.length)];

      // Find direction with most draft techs
      const mostDraft = DATA.directions.reduce((max, d) =>
        d.stats.byStatus.draft > (max?.stats.byStatus.draft || 0) ? d : max, null);

      container.innerHTML = `
        <div class="quick-action" onclick="toggleDependencyMap()">
          <div class="quick-action-icon">üó∫Ô∏è</div>
          <div class="quick-action-content">
            <div class="quick-action-title">–ö–∞—Ä—Ç–∞ —Å–≤—è–∑–µ–π</div>
            <div class="quick-action-desc">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</div>
          </div>
        </div>
        <div class="quick-action" onclick="showDirection('${randomDir.id}')">
          <div class="quick-action-icon">${DIRECTION_ICONS[randomDir.id]}</div>
          <div class="quick-action-content">
            <div class="quick-action-title">–°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
            <div class="quick-action-desc">${randomDir.name}</div>
          </div>
        </div>
        ${randomTech ? `
        <div class="quick-action" onclick="showTechnology('${randomTech.id}')">
          <div class="quick-action-icon">üìÑ</div>
          <div class="quick-action-content">
            <div class="quick-action-title">–°–ª—É—á–∞–π–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è</div>
            <div class="quick-action-desc">${randomTech.name}</div>
          </div>
        </div>
        ` : ''}
        ${mostDraft ? `
        <div class="quick-action" onclick="showDirection('${mostDraft.id}')">
          <div class="quick-action-icon">‚úèÔ∏è</div>
          <div class="quick-action-content">
            <div class="quick-action-title">–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è</div>
            <div class="quick-action-desc">${mostDraft.name} (${mostDraft.stats.byStatus.draft} —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤)</div>
          </div>
        </div>
        ` : ''}
      `;
    }

    // Overall Progress
    function renderOverallProgress() {
      const container = document.getElementById('overall-progress');
      const total = DATA.meta.totalTechnologies;
      const approved = DATA.directions.reduce((sum, d) => sum + d.stats.byStatus.approved, 0);
      const review = DATA.directions.reduce((sum, d) => sum + d.stats.byStatus.review, 0);
      const draft = DATA.directions.reduce((sum, d) => sum + d.stats.byStatus.draft, 0);
      const pct = total > 0 ? Math.round((approved / total) * 100) : 0;

      container.innerHTML = `
        <div class="overall-progress-header">
          <div class="overall-progress-title">üìä –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞</div>
          <div class="overall-progress-pct">${pct}%</div>
        </div>
        <div class="overall-progress-bar">
          <div class="overall-progress-fill" style="width: ${pct}%"></div>
        </div>
        <div class="overall-progress-stats">
          <span>‚úèÔ∏è ${draft} —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤</span>
          <span>üëÄ ${review} –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
          <span>‚úÖ ${approved} –≥–æ—Ç–æ–≤–æ</span>
          <span>üìÑ ${total} –≤—Å–µ–≥–æ</span>
        </div>
      `;
    }

    // Dependency Map
    let dependencyMapVisible = false;

    function toggleDependencyMap() {
      dependencyMapVisible = !dependencyMapVisible;
      document.getElementById('dependency-map').classList.toggle('active', dependencyMapVisible);
      document.querySelector('.nav-btn').classList.toggle('active', dependencyMapVisible);
      if (dependencyMapVisible) {
        renderDependencyMap();
      }
    }

    function renderDependencyMap() {
      const svg = document.getElementById('dependency-svg');
      const width = svg.clientWidth || 800;
      const height = 400;

      // Node positions - arranged in logical flow
      const positions = {
        'D01': { x: 80, y: 50 },   // –î–µ–º–æ–Ω—Ç–∞–∂
        'D02': { x: 180, y: 100 }, // –≠–ª–µ–∫—Ç—Ä–∏–∫–∞
        'D03': { x: 180, y: 170 }, // –°–ª–∞–±–æ—Ç–æ—á–∫–∞
        'D04': { x: 180, y: 240 }, // –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞
        'D05': { x: 300, y: 135 }, // –ö–ª–∏–º–∞—Ç
        'D06': { x: 300, y: 205 }, // –ú–æ–Ω—Ç–∞–∂
        'D07': { x: 420, y: 170 }, // –ò–∑–æ–ª—è—Ü–∏—è
        'D08': { x: 540, y: 100 }, // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç–µ–Ω
        'D09': { x: 660, y: 100 }, // –®—Ç—É–∫–∞—Ç—É—Ä–∫–∞
        'D10': { x: 780, y: 50 },  // –ü–æ–∫—Ä–∞—Å–∫–∞
        'D11': { x: 780, y: 100 }, // –û–±–æ–∏
        'D12': { x: 780, y: 170 }, // –ü–ª–∏—Ç–∫–∞
        'D13': { x: 420, y: 280 }, // –ü–æ–ª—ã —á–µ—Ä–Ω–æ–≤—ã–µ
        'D14': { x: 900, y: 135 }, // –ü–æ–ª—ã —á–∏—Å—Ç–æ–≤—ã–µ
        'D15': { x: 1000, y: 50 }, // –û–∫–Ω–∞
        'D16': { x: 1000, y: 100 }, // –î–≤–µ—Ä–∏ –º–µ–∂–∫–æ–º
        'D17': { x: 1000, y: 150 }, // –î–≤–µ—Ä–∏ –≤—Ö–æ–¥–Ω—ã–µ
        'D18': { x: 540, y: 320 }, // –§–∞—Å–∞–¥
        'D00': { x: 80, y: 320 }   // –ö—É–ª—å—Ç—É—Ä–∞
      };

      // Scale to fit
      const maxX = Math.max(...Object.values(positions).map(p => p.x));
      const scale = (width - 100) / maxX;
      Object.keys(positions).forEach(k => {
        positions[k].x = 50 + positions[k].x * scale * 0.9;
        positions[k].y = 30 + positions[k].y * 0.95;
      });

      // Build edges from dependencies
      let edgesHtml = '';
      DATA.directions.forEach(dir => {
        if (dir.requires) {
          dir.requires.forEach(reqId => {
            const from = positions[reqId];
            const to = positions[dir.id];
            if (from && to) {
              edgesHtml += `<path class="dep-edge" d="M${from.x},${from.y} Q${(from.x + to.x) / 2},${(from.y + to.y) / 2 - 20} ${to.x},${to.y}"/>`;
            }
          });
        }
      });

      // Build nodes
      let nodesHtml = '';
      DATA.directions.forEach(dir => {
        const pos = positions[dir.id];
        if (!pos) return;
        const color = getBlockColor(dir.block);
        const icon = DIRECTION_ICONS[dir.id];
        nodesHtml += `
          <g class="dep-node" onclick="showDirection('${dir.id}')">
            <circle class="dep-node-circle" cx="${pos.x}" cy="${pos.y}" r="22" fill="${color}"/>
            <text class="dep-node-text" x="${pos.x}" y="${pos.y}">${icon}</text>
            <text class="dep-node-label" x="${pos.x}" y="${pos.y + 35}">${dir.id}</text>
          </g>
        `;
      });

      // Clear and add
      svg.innerHTML = `
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#8b949e"/>
          </marker>
        </defs>
        ${edgesHtml}
        ${nodesHtml}
      `;
    }

    function getBlockColor(block) {
      const colors = {
        '–°–∏—Å—Ç–µ–º–Ω–æ–µ': '#8b949e',
        '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞': '#f85149',
        '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏': '#58a6ff',
        '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤': '#a371f7',
        '–ü–æ–ª—ã': '#f0883e',
        '–û—Ç–¥–µ–ª–∫–∞': '#3fb950',
        '–î–≤–µ—Ä–∏/–û–∫–Ω–∞': '#db61a2',
        '–§–∞—Å–∞–¥': '#39c5cf'
      };
      return colors[block] || '#8b949e';
    }

    // Update breadcrumb
    function updateBreadcrumb(view, data = {}) {
      const breadcrumb = document.getElementById('nav-breadcrumb');

      if (view === 'main') {
        breadcrumb.innerHTML = `<span class="nav-crumb active">–ì–ª–∞–≤–Ω–∞—è</span>`;
      } else if (view === 'direction') {
        const dir = DATA.directions.find(d => d.id === data.directionId);
        const icon = DIRECTION_ICONS[data.directionId] || 'üìÅ';
        breadcrumb.innerHTML = `
          <span class="nav-crumb" onclick="showMainView()">–ì–ª–∞–≤–Ω–∞—è</span>
          <span class="nav-crumb-sep">‚Ä∫</span>
          <span class="nav-crumb active">${icon} ${dir?.name || data.directionId}</span>
        `;
      } else if (view === 'technology') {
        const result = findTechnology(data.techId);
        if (result) {
          const { tech, direction } = result;
          const icon = DIRECTION_ICONS[direction.id] || 'üìÅ';
          breadcrumb.innerHTML = `
            <span class="nav-crumb" onclick="showMainView()">–ì–ª–∞–≤–Ω–∞—è</span>
            <span class="nav-crumb-sep">‚Ä∫</span>
            <span class="nav-crumb" onclick="showDirection('${direction.id}')">${icon} ${direction.name}</span>
            <span class="nav-crumb-sep">‚Ä∫</span>
            <span class="nav-crumb active">${tech.id}</span>
          `;
        }
      }
    }

    function renderStats() {
      const stats = document.getElementById('stats');
      const techByStatus = DATA.directions.reduce((acc, d) => {
        acc.draft += d.stats.byStatus.draft;
        acc.review += d.stats.byStatus.review;
        acc.approved += d.stats.byStatus.approved;
        return acc;
      }, { draft: 0, review: 0, approved: 0 });

      stats.innerHTML = `
        <div class="stat-card directions">
          <div class="stat-icon">üìÅ</div>
          <div class="stat-value">${DATA.meta.totalDirections}</div>
          <div class="stat-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</div>
        </div>
        <div class="stat-card technologies">
          <div class="stat-icon">üìÑ</div>
          <div class="stat-value">${DATA.meta.totalTechnologies}</div>
          <div class="stat-label">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π</div>
        </div>
        <div class="stat-card draft">
          <div class="stat-icon">‚úèÔ∏è</div>
          <div class="stat-value">${techByStatus.draft}</div>
          <div class="stat-label">–í —á–µ—Ä–Ω–æ–≤–∏–∫–µ</div>
        </div>
        <div class="stat-card approved">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-value">${techByStatus.approved}</div>
          <div class="stat-label">–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</div>
        </div>
      `;
    }

    function renderTimeline() {
      const timeline = document.getElementById('timeline');
      timeline.innerHTML = TIMELINE_STEPS.map(step => `
        <div class="timeline-step ${step.class}">
          <div class="timeline-number">${step.num}</div>
          <div class="timeline-content">
            <div class="timeline-title">${step.title}</div>
            <div class="timeline-desc">${step.desc}</div>
            <div class="timeline-tags">
              ${step.directions.map(id => {
                const dir = DATA.directions.find(d => d.id === id);
                return dir ? `<span class="timeline-tag" onclick="showDirection('${id}')">${DIRECTION_ICONS[id]} ${dir.name}</span>` : '';
              }).join('')}
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderFilters() {
      const filters = document.getElementById('filters');
      filters.innerHTML = `
        <button class="filter-btn ${currentFilter === 'all' ? 'active' : ''}" onclick="setFilter('all')">
          üìã –í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        </button>
        <button class="filter-btn ${currentFilter === '—á–µ—Ä–Ω–æ–≤–∞—è' ? 'active' : ''}" onclick="setFilter('—á–µ—Ä–Ω–æ–≤–∞—è')">
          üî® –ß–µ—Ä–Ω–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã
        </button>
        <button class="filter-btn ${currentFilter === '—á–∏—Å—Ç–æ–≤–∞—è' ? 'active' : ''}" onclick="setFilter('—á–∏—Å—Ç–æ–≤–∞—è')">
          ‚ú® –ß–∏—Å—Ç–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã
        </button>
      `;
    }

    function renderSections() {
      const container = document.getElementById('sections-container');
      const noResults = document.getElementById('no-results');

      // Group directions by block
      const blocks = {};
      DATA.directions.forEach(d => {
        if (!blocks[d.block]) blocks[d.block] = [];
        blocks[d.block].push(d);
      });

      // Filter
      const filteredBlocks = {};
      Object.entries(blocks).forEach(([block, dirs]) => {
        const filtered = dirs.filter(d => {
          if (currentFilter === '—á–µ—Ä–Ω–æ–≤–∞—è' && !d.stages.includes('—á–µ—Ä–Ω–æ–≤–∞—è')) return false;
          if (currentFilter === '—á–∏—Å—Ç–æ–≤–∞—è' && !d.stages.includes('—á–∏—Å—Ç–æ–≤–∞—è')) return false;
          if (searchQuery) {
            const q = searchQuery.toLowerCase();
            const nameMatch = d.name.toLowerCase().includes(q);
            const techMatch = d.technologies.some(t =>
              t.name.toLowerCase().includes(q) || t.id.toLowerCase().includes(q)
            );
            return nameMatch || techMatch;
          }
          return true;
        });
        if (filtered.length > 0) {
          filteredBlocks[block] = filtered;
        }
      });

      if (Object.keys(filteredBlocks).length === 0) {
        container.innerHTML = '';
        noResults.style.display = 'block';
        return;
      }

      noResults.style.display = 'none';

      // Sort blocks by order
      const sortedBlocks = Object.entries(filteredBlocks).sort((a, b) => {
        return (BLOCK_INFO[a[0]]?.order || 99) - (BLOCK_INFO[b[0]]?.order || 99);
      });

      container.innerHTML = sortedBlocks.map(([block, dirs]) => {
        const blockClass = BLOCK_CLASSES[block] || '';
        const info = BLOCK_INFO[block] || { icon: 'üìÅ', title: block };
        const totalTech = dirs.reduce((sum, d) => sum + d.stats.total, 0);

        return `
          <div class="section-group">
            <div class="section-header ${blockClass}">
              <span class="section-icon">${info.icon}</span>
              <span class="section-title">${info.title}</span>
              <span class="section-count">${dirs.length} –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π ¬∑ ${totalTech} —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</span>
            </div>
            <div class="directions-grid">
              ${dirs.map(d => renderDirectionCard(d)).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    function renderDirectionCard(d) {
      const blockClass = BLOCK_CLASSES[d.block] || '';
      const icon = DIRECTION_ICONS[d.id] || 'üìÅ';
      const sizeClass = d.stats.total >= 15 ? 'size-large' : '';

      const total = d.stats.total || 1;
      const approvedPct = (d.stats.byStatus.approved / total * 100).toFixed(0);
      const reviewPct = (d.stats.byStatus.review / total * 100).toFixed(0);
      const draftPct = (d.stats.byStatus.draft / total * 100).toFixed(0);

      return `
        <div class="direction-card ${blockClass} ${sizeClass}" onclick="showDirection('${d.id}')">
          <div class="card-header">
            <span class="card-icon">${icon}</span>
            <span class="card-id">${d.id}</span>
          </div>
          <div class="card-title">${d.name}</div>
          <div class="card-stages">
            ${d.stages.map(s => `<span class="stage-badge ${s}">${s}</span>`).join('')}
          </div>
          <div class="card-progress">
            <div class="progress-bar-multi">
              <div class="progress-segment approved" style="width: ${approvedPct}%"></div>
              <div class="progress-segment review" style="width: ${reviewPct}%"></div>
              <div class="progress-segment draft" style="width: ${draftPct}%"></div>
            </div>
            <div class="progress-legend">
              <span><span class="legend-dot draft"></span> ${d.stats.byStatus.draft} —á–µ—Ä–Ω–æ–≤–∏–∫</span>
              <span><span class="legend-dot approved"></span> ${d.stats.byStatus.approved} –≥–æ—Ç–æ–≤–æ</span>
            </div>
          </div>
          <div class="card-tech-count">${d.stats.total}</div>
          <div class="card-tech-label">—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</div>
        </div>
      `;
    }

    function setFilter(filter) {
      currentFilter = filter;
      renderFilters();
      renderSections();
    }

    function showDirection(id) {
      const direction = DATA.directions.find(d => d.id === id);
      if (!direction) return;

      document.getElementById('main-view').style.display = 'none';
      document.getElementById('direction-view').classList.add('active');
      document.getElementById('tech-view').classList.remove('active');
      updateBreadcrumb('direction', { directionId: id });
      window.scrollTo(0, 0);

      const content = document.getElementById('direction-content');
      const blockClass = BLOCK_CLASSES[direction.block] || '';
      const icon = DIRECTION_ICONS[direction.id] || 'üìÅ';

      const chernovye = direction.technologies.filter(t => t.stage === '—á–µ—Ä–Ω–æ–≤–∞—è');
      const chistovye = direction.technologies.filter(t => t.stage === '—á–∏—Å—Ç–æ–≤–∞—è');

      // Group technologies by process
      const byProcess = {};
      direction.technologies.forEach(t => {
        const proc = t.process || '–î—Ä—É–≥–æ–µ';
        if (!byProcess[proc]) byProcess[proc] = [];
        byProcess[proc].push(t);
      });

      const processFlowHtml = Object.keys(byProcess).length > 1 ? `
        <div class="process-flow">
          <div class="process-flow-title">üîÑ –ü—Ä–æ—Ü–µ—Å—Å—ã –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏</div>
          <div class="process-steps">
            ${Object.entries(byProcess).map(([proc, techs], idx) => `
              ${idx > 0 ? '<div class="process-arrow">‚Üí</div>' : ''}
              <div class="process-step" onclick="filterByProcess('${proc}')">
                <div class="process-step-num">${idx + 1}</div>
                <div class="process-step-title">${proc}</div>
                <div class="process-step-desc">${techs.length} —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</div>
                <div class="process-step-count">${techs.filter(t => t.status === 'approved').length}/${techs.length} –≥–æ—Ç–æ–≤–æ</div>
              </div>
            `).join('')}
          </div>
        </div>
      ` : '';

      content.innerHTML = `
        <div class="direction-header ${blockClass}">
          <div class="direction-icon">${icon}</div>
          <div class="card-id" style="display: inline-block; margin-bottom: 8px;">${direction.id}</div>
          <h1 class="direction-title">${direction.name}</h1>
          <div class="direction-meta">
            <span>üìÑ ${direction.stats.total} —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</span>
            <span>üì¶ ${direction.block}</span>
            ${direction.stages.map(s => `<span class="stage-badge ${s}">${s}</span>`).join(' ')}
          </div>
          <div class="direction-deps">
            ${direction.requires.length > 0 ? `
              <div class="dep-group">
                <h4>‚¨ÖÔ∏è –¢—Ä–µ–±—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h4>
                <div class="dep-tags">
                  ${direction.requires.map(r => {
                    const dep = DATA.directions.find(d => d.id === r);
                    const depIcon = DIRECTION_ICONS[r] || 'üìÅ';
                    return `<div class="dep-tag requires" onclick="showDirection('${r}')">
                      <span class="dep-tag-icon">${depIcon}</span>
                      ${r} ${dep ? dep.name : ''}
                    </div>`;
                  }).join('')}
                </div>
              </div>
            ` : ''}
            ${direction.opens.length > 0 ? `
              <div class="dep-group">
                <h4>‚û°Ô∏è –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å</h4>
                <div class="dep-tags">
                  ${direction.opens.map(o => {
                    const dep = DATA.directions.find(d => d.id === o);
                    const depIcon = DIRECTION_ICONS[o] || 'üìÅ';
                    return `<div class="dep-tag opens" onclick="showDirection('${o}')">
                      <span class="dep-tag-icon">${depIcon}</span>
                      ${o} ${dep ? dep.name : ''}
                    </div>`;
                  }).join('')}
                </div>
              </div>
            ` : ''}
          </div>
        </div>

        ${processFlowHtml}

        ${chernovye.length > 0 ? `
          <div class="stage-section">
            <h3 class="stage-title —á–µ—Ä–Ω–æ–≤–∞—è">
              üî® –ß–µ—Ä–Ω–æ–≤–æ–π —ç—Ç–∞–ø
              <span class="count">${chernovye.length} —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</span>
            </h3>
            <div class="tech-list">
              ${chernovye.map(t => renderTechItem(t)).join('')}
            </div>
          </div>
        ` : ''}

        ${chistovye.length > 0 ? `
          <div class="stage-section">
            <h3 class="stage-title —á–∏—Å—Ç–æ–≤–∞—è">
              ‚ú® –ß–∏—Å—Ç–æ–≤–æ–π —ç—Ç–∞–ø
              <span class="count">${chistovye.length} —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</span>
            </h3>
            <div class="tech-list">
              ${chistovye.map(t => renderTechItem(t)).join('')}
            </div>
          </div>
        ` : ''}
      `;
    }

    // Filter by process (placeholder - could add highlighting)
    function filterByProcess(processName) {
      // For now, just scroll to the tech list - could add filtering later
      const techList = document.querySelector('.tech-list');
      if (techList) techList.scrollIntoView({ behavior: 'smooth' });
    }

    function renderTechItem(tech) {
      const difficultyDots = Array(5).fill(0).map((_, i) =>
        `<span class="${i < tech.difficulty ? 'filled' : ''}"></span>`
      ).join('');

      return `
        <div class="tech-item" onclick="showTechnology('${tech.id}')" style="cursor: pointer;">
          <span class="tech-id">${tech.id}</span>
          <span class="tech-name">${tech.name}</span>
          <div class="tech-meta">
            <div class="tech-difficulty" title="–°–ª–æ–∂–Ω–æ—Å—Ç—å: ${tech.difficulty}/5">
              ${difficultyDots}
            </div>
            <span class="tech-status ${tech.status}">${tech.status}</span>
          </div>
        </div>
      `;
    }

    // Track navigation history
    let previousView = 'main';
    let previousDirectionId = null;

    // Find technology by ID across all directions
    function findTechnology(techId) {
      for (const dir of DATA.directions) {
        const tech = dir.technologies.find(t => t.id === techId);
        if (tech) return { tech, direction: dir };
      }
      return null;
    }

    // Show technology page
    function showTechnology(techId) {
      const result = findTechnology(techId);
      if (!result) return;

      const { tech, direction } = result;
      const icon = DIRECTION_ICONS[direction.id] || 'üìÅ';
      const blockClass = BLOCK_CLASSES[direction.block] || '';

      // Save previous view for back button
      if (document.getElementById('direction-view').classList.contains('active')) {
        previousView = 'direction';
        previousDirectionId = direction.id;
      } else {
        previousView = 'main';
      }

      // Hide other views
      document.getElementById('main-view').style.display = 'none';
      document.getElementById('direction-view').classList.remove('active');
      document.getElementById('tech-view').classList.add('active');
      updateBreadcrumb('technology', { techId });
      window.scrollTo(0, 0);

      // Set back button
      const backBtn = document.getElementById('tech-back-btn');
      backBtn.textContent = previousView === 'direction' ? `‚Üê ${direction.name}` : '‚Üê –í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è';
      backBtn.onclick = () => {
        if (previousView === 'direction' && previousDirectionId) {
          showDirection(previousDirectionId);
        } else {
          showMainView();
        }
      };

      // Stats are now in header, no longer in sidebar

      // Render TOC - only show if > 5 sections
      const sections = tech.sections || [];
      const tocCard = document.getElementById('tech-toc').parentElement;

      if (sections.length > 5) {
        tocCard.style.display = 'block';
        const tocIcons = {
          '–ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å': '‚úÖ',
          '–ö–æ–≥–¥–∞ –ù–ï –ø—Ä–∏–º–µ–Ω—è—Ç—å': '‚ùå',
          '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞': 'üëç',
          '–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏': 'üëé',
          '–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã': 'üì¶',
          '–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã': 'üîß',
          '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞': 'üìã',
          '–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è': 'üìù',
          '–ß–µ–∫-–ª–∏—Å—Ç –∫–∞—á–µ—Å—Ç–≤–∞': '‚úÖ',
          '–ü—Ä–∏—ë–º–∫–∞ —Ä–∞–±–æ—Ç—ã': 'üéØ',
          '–¢–µ—Ö–Ω–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏': '‚ö†Ô∏è',
          '–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã': '‚ùì',
          '–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏': 'üîó',
          '–í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∞': 'üìö'
        };

        document.getElementById('tech-toc').innerHTML = sections.map(section => {
          const icon = tocIcons[section] || 'üìÑ';
          const id = section.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
          return `<li><a href="#${id}" onclick="scrollToSection('${id}')">${icon} ${section}</a></li>`;
        }).join('');
      } else {
        tocCard.style.display = 'none';
      }

      // Hide related technologies from sidebar - now shown inline
      const relatedCard = document.getElementById('tech-related-card');
      relatedCard.style.display = 'none';

      // Render header with stats
      document.getElementById('tech-header-container').innerHTML = `
        <div class="tech-header ${blockClass}">
          <div class="tech-breadcrumb">
            <a href="#" onclick="showMainView(); return false;">–ì–ª–∞–≤–Ω–∞—è</a>
            <span>‚Ä∫</span>
            <a href="#" onclick="showDirection('${direction.id}'); return false;">${icon} ${direction.name}</a>
            <span>‚Ä∫</span>
            <span>${tech.id}</span>
          </div>
          <div class="tech-title-row">
            <div class="tech-icon">${icon}</div>
            <div class="tech-title-content">
              <h1 class="tech-title">${tech.name}</h1>
              <p class="tech-description">${tech.description || ''}</p>
            </div>
          </div>
          <div class="tech-meta-row">
            <div class="tech-badges">
              <span class="tech-badge stage ${tech.stage}">${tech.stage}</span>
              <span class="tech-badge">üìä ${tech.difficulty}/5</span>
              <span class="tech-badge">‚è±Ô∏è ${tech.timeToLearn || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
            </div>
            <div class="tech-meta-stats">
              <div class="tech-meta-stat">
                <span>üìù</span>
                <span class="tech-meta-stat-value">${tech.stats?.steps || 0}</span>
                <span>—à–∞–≥–æ–≤</span>
              </div>
              <div class="tech-meta-stat">
                <span>üì¶</span>
                <span class="tech-meta-stat-value">${tech.stats?.materials || 0}</span>
                <span>–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</span>
              </div>
              <div class="tech-meta-stat">
                <span>üîß</span>
                <span class="tech-meta-stat-value">${tech.stats?.tools || 0}</span>
                <span>–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</span>
              </div>
            </div>
          </div>
        </div>
      `;

      // Render flow visualization
      renderTechFlow(tech, direction);

      // Render content
      if (typeof marked !== 'undefined') {
        let html = marked.parse(tech.content || '–ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
        // Add IDs to sections for scrolling
        html = html.replace(/<h2>([^<]+)<\/h2>/g, (match, title) => {
          const id = title.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
          return `<h2 id="${id}">${title}</h2>`;
        });

        // Add inline related technologies at the end if they exist
        const related = tech.related || [];
        if (related.length > 0) {
          const relatedHtml = `
            <div class="tech-related-inline">
              <div class="tech-related-inline-title">üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
              <div class="tech-related-inline-grid">
                ${related.map(r => `
                  <div class="tech-related-item" onclick="showTechnology('${r.id}')">
                    <span class="tech-related-id">${r.id}</span>
                    <div>
                      <div class="tech-related-name">${r.name || '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è'}</div>
                      ${r.reason ? `<div class="tech-related-reason">${r.reason}</div>` : ''}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          html += relatedHtml;
        }

        document.getElementById('tech-content').innerHTML = html;
      } else {
        document.getElementById('tech-content').innerHTML = `<pre>${tech.content || '–ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</pre>`;
      }
    }

    // Render flow diagram
    function renderTechFlow(tech, direction) {
      const related = tech.related || [];

      // Only show flow if there are related technologies
      if (related.length === 0) {
        document.getElementById('tech-flow-container').innerHTML = '';
        return;
      }

      const before = related.filter(r => r.reason && (r.reason.includes('–ø–µ—Ä–µ–¥') || r.reason.includes('–ü–µ—Ä–µ–¥') || r.reason.includes('–ø–æ–¥–≥–æ—Ç–æ–≤') || r.reason.includes('–Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤')));
      const after = related.filter(r => r.reason && (r.reason.includes('–ø–æ—Å–ª–µ') || r.reason.includes('–°–ª–µ–¥') || r.reason.includes('—ç—Ç–∞–ø')));
      const alternatives = related.filter(r => r.reason && (r.reason.includes('–≤–º–µ—Å—Ç–æ') || r.reason.includes('–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤')));

      // If no clear before/after, show all as related
      const hasFlow = before.length > 0 || after.length > 0;

      document.getElementById('tech-flow-container').innerHTML = `
        <div class="tech-flow">
          <div class="tech-flow-title">üìç –ú–µ—Å—Ç–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
          <div class="tech-flow-diagram">
            ${before.length > 0 ? `
              <div class="tech-flow-group">
                <div class="tech-flow-label">–ü–µ—Ä–µ–¥</div>
                <div class="tech-flow-cards">
                  ${before.map(r => `
                    <div class="tech-flow-card" onclick="showTechnology('${r.id}')">
                      <div class="tech-flow-card-id">${r.id}</div>
                      <div class="tech-flow-card-name">${r.name || ''}</div>
                    </div>
                  `).join('')}
                </div>
              </div>
              <div class="tech-flow-arrow">‚Üí</div>
            ` : ''}

            <div class="tech-flow-group">
              <div class="tech-flow-label">–¢–µ–∫—É—â–∞—è</div>
              <div class="tech-flow-cards">
                <div class="tech-flow-card current">
                  <div class="tech-flow-card-id">${tech.id}</div>
                  <div class="tech-flow-card-name">${tech.name}</div>
                </div>
              </div>
            </div>

            ${after.length > 0 ? `
              <div class="tech-flow-arrow">‚Üí</div>
              <div class="tech-flow-group">
                <div class="tech-flow-label">–ü–æ—Å–ª–µ</div>
                <div class="tech-flow-cards">
                  ${after.map(r => `
                    <div class="tech-flow-card" onclick="showTechnology('${r.id}')">
                      <div class="tech-flow-card-id">${r.id}</div>
                      <div class="tech-flow-card-name">${r.name || ''}</div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}

            ${alternatives.length > 0 ? `
              <div class="tech-flow-group" style="margin-left: 24px;">
                <div class="tech-flow-label">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã</div>
                <div class="tech-flow-cards">
                  ${alternatives.map(r => `
                    <div class="tech-flow-card" onclick="showTechnology('${r.id}')">
                      <div class="tech-flow-card-id">${r.id}</div>
                      <div class="tech-flow-card-name">${r.name || ''}</div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    // Scroll to section
    function scrollToSection(id) {
      const element = document.getElementById(id);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // Hide tech view
    function hideTechView() {
      document.getElementById('tech-view').classList.remove('active');
    }

    function showMainView() {
      document.getElementById('main-view').style.display = 'block';
      document.getElementById('direction-view').classList.remove('active');
      document.getElementById('tech-view').classList.remove('active');
      updateBreadcrumb('main');
      window.scrollTo(0, 0);
    }

    // Search
    document.getElementById('search').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderSections();
    });

    // Init
    loadData();

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      // Escape key = go back
      if (e.key === 'Escape') {
        const techView = document.getElementById('tech-view');
        const dirView = document.getElementById('direction-view');

        if (techView.classList.contains('active')) {
          // If in tech view, go back to direction
          const breadcrumbLinks = document.querySelectorAll('#nav-breadcrumb .nav-crumb');
          if (breadcrumbLinks.length >= 2) {
            breadcrumbLinks[breadcrumbLinks.length - 2].click();
          }
        } else if (dirView.classList.contains('active')) {
          // If in direction view, go back to main
          showMainView();
        }
      }

      // "/" key = focus search (but not if already in an input)
      if (e.key === '/' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
        e.preventDefault();
        document.getElementById('search').focus();
      }
    });

    // Scroll indicator
    window.addEventListener('scroll', function() {
      const nav = document.getElementById('top-nav');
      const scrollIndicator = nav.querySelector('.nav-scroll-indicator');
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      const scrollTop = window.scrollY;

      // Calculate scroll progress
      const scrollableHeight = documentHeight - windowHeight;
      const scrollProgress = scrollableHeight > 0 ? (scrollTop / scrollableHeight) : 0;

      // Update indicator
      if (scrollTop > 50) {
        nav.classList.add('scrolled');
        scrollIndicator.style.transform = `scaleX(${scrollProgress})`;
      } else {
        nav.classList.remove('scrolled');
      }
    });

  </script>
</body>
</html>
